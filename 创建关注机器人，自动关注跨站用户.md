mastodon创建关注机器人，自动关注跨站用户

### 前言

mastodon的跨站时间轴的显示机制有点复杂，简而言之可以这么概括

“假设我处于A站，那么我发布的所有公开嘟文，都会显示在A站本站时间轴”

“如果你没有被任何一个B站用户关注的话，那么你的动态就不会显示在B站的跨站时间轴”

所以当你成功创建一个站点的时候，你的跨站时间轴是空的，因为你还未关注外站的同学

### 页面操作

首先注册一个小号机器人

![](https://img2022.cnblogs.com/blog/1446116/202210/1446116-20221031132130895-37064197.png)

创建好了后，在设置里选择开发，创建新应用，权限默认就行

![](https://img2022.cnblogs.com/blog/1446116/202210/1446116-20221031132315036-1438912912.png)

这时候你点击进入你的应用，那么就会得到一个访问令牌

![](https://img2022.cnblogs.com/blog/1446116/202210/1446116-20221031134216915-231514320.png)

将令牌拷贝下来

在本地目录下新建一个文件夹，并且新建一个Dockerfile

```
mkdir ~/docker/autofollow
cd ~/docker/autofollow
nano Dockerfile
```

将以下内容拷贝进文件里

```
FROM python:3.7-slim
WORKDIR /home/mastodon

# 这里换成你的令牌
ENV TOKEN er_bbbbbbb-aaaaaaaaaaaaaaaaaaaaaaaaaa
# 这里换成你们的域名
ENV URL fzu.closed.social
# 这里换成bot的用户名（不是昵称），这里以@Follow_bot@fzu.closed.social填写方式为例
ENV BOTNAME Follow_bot
# 这里是电报的bot的token，获取方式见下面
ENV TELETOKEN 1111111111:bbbbbbbbbbbbbbbbbbbbbbb
# 这里是电报的ChatID，获取方式在@getmyid_bot中获取
ENV TELECHATID 111111111

RUN apt update && \
    apt install -y wget nano
RUN wget https://raw.githubusercontent.com/MokouTyan/mastodon_autofollow/main/autofollow.py
RUN pip install numpy requests
RUN pip install python-telegram-bot --upgrade
RUN sed -i 's/1111111111/'${TOKEN}'/' autofollow.py && \
    sed -i 's/2222222222/'${URL}'/' autofollow.py && \
    sed -i 's/3333333333/'${BOTNAME}'/' autofollow.py && \
    sed -i 's/4444444444/'${TELETOKEN}'/' autofollow.py && \
    sed -i 's/5555555555/'${TELECHATID}'/' autofollow.py
    
CMD ["python","autofollow.py"]
```

然后生成这个docker镜像，注意后面有个点

```
docker build -t autofollow .
```

先看一下自己的follow有多少关注量，然后

```
docker run --name autofollow autofollow 
```

看看机器人的关注量有没有变化

确认没有问题后，使用定时任务（每天一次就好

```
crontab -e
# 如果这里有选择，那就选nano编辑器，比较方便
```

在里面添加

23 7 * * *的意思是每天的7点23分运行一次，最好不要和我时间一样，同时做可能丢包啥的，随便改个时间吧

docker run --name autofollow autofollow的意思是选取autofollow，然后命名为autofollow运行

\>\>的意思是追加，将日志输入到某个文件中

```
# 7点23运行这个容器
23 7 * * * docker run --name autofollow autofollow >> ~/docker/autofollow/log.txt
# 8点23删除这个容器
23 8 * * * docker rm autofollow
```

想查看日志的话

```
cat ~/docker/autofollow/log.txt
```

### 电报创建机器人

![](https://img2022.cnblogs.com/blog/1446116/202210/1446116-20221031164238375-73855788.png)

如图，将这段token复制下来就行

然后要点上面那个t.me的机器人链接（因为机器人不能联系陌生人，所以有TOKEN后，记得添加一下机器人为好友