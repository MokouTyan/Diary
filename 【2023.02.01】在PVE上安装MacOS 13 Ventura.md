【2023.02.01】在PVE上安装MacOS 13 Ventura

本文参考链接：[Installing macOS 13 Ventura on Proxmox 7.2 – Nicholas Sherlock](https://www.nicksherlock.com/2022/10/installing-macos-13-ventura-on-proxmox/)

本次平台是i9 9980hk，CPU尽量新一点应该都可以

### 创建LXC

![image-20230202142434562](https://i0.hdslb.com/bfs/new_dyn/c74c585e56d3cb7da6b01497db6bebf11865692.png)

![image-20230202142446382](https://i0.hdslb.com/bfs/new_dyn/4a1bb7dbb9b167e591cb1413a7472a611865692.png)

![image-20230202142501013](https://i0.hdslb.com/bfs/new_dyn/29bd7f0a211c90fc125600e6ad331d331865692.png)

![image-20230202142513486](https://i0.hdslb.com/bfs/new_dyn/b40ba561e9441b2a438b0648c00c20c81865692.png)

![image-20230202142525377](https://i0.hdslb.com/bfs/new_dyn/58f6f19ae07f28686b3435594d7d76081865692.png)

![image-20230202142535097](https://i0.hdslb.com/bfs/new_dyn/f5de3f762ca6c2459a2974344aa6c2a41865692.png)

剩下默认

### 启动虚拟机并且下载

```
sudo sed -i 's/archive.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list
apt update
apt upgrade -y
sudo apt-get install qemu uml-utilities virt-manager git \
    wget libguestfs-tools p7zip-full make dmg2img -y
# 下载
cd ~
git clone --depth 1 --recursive https://github.com/kholia/OSX-KVM.git
cd OSX-KVM
#下载ISO
./fetch-macOS-v2.py
#转换为ISO
dmg2img -i BaseSystem.dmg BaseSystem.img
```

![image-20230202142627103](https://i0.hdslb.com/bfs/new_dyn/3cde1895ce57d1354e139f180b9371521865692.png)

![image-20230202142639849](https://i0.hdslb.com/bfs/new_dyn/6ebdb20385d616e72d058c6e5812d4cf1865692.png)

传输到本机PVE中

先看看LXC的路径

```
pwd
#/root/OSX-KVM
```

105自己改一下

```
pct pull 105 /root/OSX-KVM/BaseSystem.img /var/lib/vz/template/iso/MacOS13.img
```

就可以看到了

![image-20230202142651691](https://i0.hdslb.com/bfs/new_dyn/bf835bc56ab2733fd248ed3e0199a6461865692.png)

#### 下载OpenCore

```
cd /var/lib/vz/template/iso/
wget https://github.com/thenickdude/KVM-Opencore/releases/download/v19/OpenCore-v19.iso.gz
gzip -d OpenCore-v19.iso.gz
```

删掉这台下载用的虚拟机

### 创建Mac虚拟机

![image-20230202142707305](https://i0.hdslb.com/bfs/new_dyn/08c77aaca64d9afec5258cdd35cc5f111865692.png)

![image-20230202142718602](https://i0.hdslb.com/bfs/new_dyn/5553cddf332b6820739093698c91071e1865692.png)

![image-20230202142731780](https://i0.hdslb.com/bfs/new_dyn/c0418dba1d217241450bff75d5054e361865692.png)

![image-20230202142743232](https://i0.hdslb.com/bfs/new_dyn/b940729b7d275338076d6d4e2e17a2531865692.png)

![image-20230202142754946](https://i0.hdslb.com/bfs/new_dyn/a8402eea7cd19252d6981fd8de99e9db1865692.png)

![image-20230202142804725](https://i0.hdslb.com/bfs/new_dyn/c3bc0270caf10e38e4128b08d121a1c41865692.png)

![image-20230202142817087](https://i0.hdslb.com/bfs/new_dyn/775df5ba21ce4c564f38ab66b8e8cb3b1865692.png)

后续默认

添加CD/DVD驱动

![image-20230202142826841](https://i0.hdslb.com/bfs/new_dyn/c466bf7d3e65545e36ddfbce56f91f561865692.png)

在PVE的Shell里输入，避免循环引导

```
echo "options kvm ignore_msrs=Y" >> /etc/modprobe.d/kvm.conf && update-initramfs -k all -u
```

编辑配置，105改一下

```
nano /etc/pve/qemu-server/105.conf
```

加入

```
args: -device isa-applesmc,osk="ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc" -smbios type=2 -device usb-kbd,bus=ehci.0,port=2 -global nec-usb-xhci.msi=off -global ICH9-LPC.acpi-pci-hotplug-with-bridge-support=off -cpu host,vendor=GenuineIntel,+invtsc,+hypervisor,kvm=on,vmware-cpuid-freq=on
```

将ide的两行的media=cdrom改为

```
cache=unsafe
```

保存退出

### 安装macOS

启动虚拟机，进入第一个

![image-20230202142921805](https://i0.hdslb.com/bfs/new_dyn/2b11b6b8f2a93b52c42ae870b386ceed1865692.png)

![image-20230202142933651](https://i0.hdslb.com/bfs/new_dyn/64a6c703045203273e62e22ed3815da01865692.png)

![image-20230202135838473](https://i0.hdslb.com/bfs/new_dyn/fa7a4865dad6f1524f8ec749bd2c03da1865692.png)

回到上一层

![image-20230202135926278](https://i0.hdslb.com/bfs/new_dyn/de3b82fc81429c48a52430d8eeb0eda61865692.png)

一直下一步就可以

![image-20230202135944303](https://i0.hdslb.com/bfs/new_dyn/892ffe94c256675ed805611286937ef71865692.png)

![image-20230202140019941](https://i0.hdslb.com/bfs/new_dyn/86148ffdccc2876876df9f7fa263142d1865692.png)

选左边的硬盘

![image-20230202140535132](https://i0.hdslb.com/bfs/new_dyn/d4ea9b1663ff7150f212a2e3ca95c6051865692.png)

重启后选择installer，可能要选很多次

![image-20230202141834093](https://i0.hdslb.com/bfs/new_dyn/20fd594d7c1dcf3c1a3c2466848370f11865692.png)

最后一次要选择自己的盘名，一般都在第二个