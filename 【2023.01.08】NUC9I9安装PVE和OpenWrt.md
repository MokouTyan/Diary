【2023.01.08】NUC9I9安装PVE和OpenWrt

前面的教程可以看：[【2022.11.17】N5105安装PVE系统，关联proxmox - Mokou - 博客园 (cnblogs.com)](https://www.cnblogs.com/mokou/p/16902002.html)

本文主要做一个备注，方便以后查阅

同时改路由器将作为一个旁路由使用，不作为主路由

| 网口 | 名称     | 设备位置     | 作用    |      |
| ---- | -------- | ------------ | ------- | ---- |
| 上   | enp112s0 | 0000:70:00.0 | openwrt |      |
| 下   | eno1     | 0000:00:1f.6 |         |      |
| 无线 | wlp3s0   | 0000:03:00.0 |         |      |

### 新增磁盘

整盘添加

![image-20230108214232235](https://i0.hdslb.com/bfs/album/55d10a12a42812968b7fc7cd3d5dd76b18031285.png)

创建存储池

![image-20230108214633186](https://i0.hdslb.com/bfs/album/64229943e80ab2241220348c8ff599b813aef880.png)

### 软路由灾备

将软路由虚拟机先停止，然后在备份处

![image-20230108220129367](https://i0.hdslb.com/bfs/album/c9c998641137b729b8efc02f879d0a73238c1af9.png)

还原方法是这样

![image-20230108220502372](https://i0.hdslb.com/bfs/album/2fceccabfcf3095dadb686d1abc2d5e93035ff30.png)

### 部署LXC容器

CT模板换源

```
cp /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm_back
sed -i 's|http://download.proxmox.com|https://mirrors.tuna.tsinghua.edu.cn/proxmox|g' /usr/share/perl5/PVE/APLInfo.pm
systemctl restart pvedaemon.service
```

下载模板

![image-20230108221119777](https://i0.hdslb.com/bfs/album/81b6f32c3e409e9fa1d9e8dec914677dca33ee50.png)

### 创建CT

![image-20230108221307506](https://i0.hdslb.com/bfs/album/d9296f7b1869f99c8205949d342e08a02f5f3724.png)

![image-20230108221349812](https://i0.hdslb.com/bfs/album/a2c5cb5d39d057554aa656f32bc1f165d724264b.png)

![image-20230108221421144](https://i0.hdslb.com/bfs/album/aa367b74cc4f6cf3906f4c678e9d968dd3e49940.png)

![image-20230108221439330](https://i0.hdslb.com/bfs/album/e4f6f26079cedf4029d29b4d28f347bbc8302322.png)

![image-20230108222057882](https://i0.hdslb.com/bfs/album/3589d61e612f77b2fa896f53d15ecbfa39d32420.png)

![image-20230108222112946](https://i0.hdslb.com/bfs/album/f89e7a2db4cbdaad78ca3d7dafe4671264911f12.png)

然后启动后参照[【2022.11.19】服务器常用命令 - Mokou - 博客园 (cnblogs.com)](https://www.cnblogs.com/mokou/p/16909309.html)

### 安装WinServer

上传ISO镜像

然后创建虚拟机

![image-20230109110941961](https://i0.hdslb.com/bfs/album/f70a9886472452a737bdeaec7175aae0517293de.png)

![image-20230109113138751](https://i0.hdslb.com/bfs/album/38628db0bdb1369159543ff5557e9069bbde03d3.png)

![image-20230109113228721](https://i0.hdslb.com/bfs/album/30688aeb4028cd61046ca5d35f153a66ce32796c.png)

![image-20230109113243913](https://i0.hdslb.com/bfs/album/1c4e1a8b31a638b3c627615332d586909b8b1ce2.png)

![image-20230109113322923](https://i0.hdslb.com/bfs/album/f20bc98810759dcfb2554c9a8e5830fd99c87139.png)

![image-20230109113345546](https://i0.hdslb.com/bfs/album/a3049e7078a35ca725f4439e069774b928f7870f.png)

后续就可以开始直接在控制台安装了

![image-20230109123137684](https://i0.hdslb.com/bfs/album/7b1bde284b86251ccebc7971962a2d8593fc2fe3.png)

### 上传虚拟驱动

下载virtio的ISO

[virtio-win/virtio-win-pkg-scripts: Scripts for packaging virtio-win drivers (github.com)](https://github.com/virtio-win/virtio-win-pkg-scripts)

然后上传

![image-20230109140702583](https://i0.hdslb.com/bfs/album/4c20d373666c5bf27cd0d113dd71887da9569336.png)

更换驱动

然后添加显卡

![image-20230109141050992](https://i0.hdslb.com/bfs/album/390ddc83f144178fd0348e5b786502c773cdba2d.png)

启动后安装显卡驱动

然后就可以看到你的显卡了

![image-20230109145430680](https://i0.hdslb.com/bfs/album/ced246d51d83dd405c1db1ec576f51ce44662939.png)