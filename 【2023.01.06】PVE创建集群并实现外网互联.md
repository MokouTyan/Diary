【2023.01.16】PVE创建集群并实现外网互联

首先要确保有两台公网ip的机器，或者两台在内网的机器，在有公网ip的机器上创建集群

### 一公网一内网

![image-20230116112237179](https://i0.hdslb.com/bfs/album/295bcd1a1c80eee841102d323e04e9b344990e5a.png)

拷贝以下内容

![image-20230116112332580](https://i0.hdslb.com/bfs/album/cf5c5561513be9b8cced91325f71a811fc9cb939.png)

取消辅助说明，输入你的公网域名

![image-20230116112451218](https://i0.hdslb.com/bfs/album/0d1e14b3db918fda307602ee443f3112de0a36b2.png)

到这里失败了，私网机器的连不上了（估计是密码同步啥的）

在公网上的机器能显示私网的机器，但是显示的是报错，总之寄了

### 删除集群

1、在待隔离节点上停止 pve-cluster 服务

```
systemctl stop pve-cluster.service
systemctl stop corosync.service
```

2、执行将待隔离节点的集群文件系统设置为本地模式的命令

```
pmxcfs  -l
```

3、执行删除 corosync 配置文件的命令

```
rm /etc/pve/corosync.conf
rm -rf /etc/corosync/*
```

4、执行重新启动集群文件系统服务的命令

```
killall pmxcfs
systemctl start pve-cluster.service
```

5、删除故障节点node文件

```
cd /etc/pve/nodes
ls
rm -rf /etc/pve/nodes/pve2    #改成故障节点对应路径，我这里是pve2
```



### 参考链接

[PVE集群移除故障节点退出集群_pve退出集群](https://blog.csdn.net/ictworker/article/details/127914638)