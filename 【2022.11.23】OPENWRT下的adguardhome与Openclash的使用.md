【2022.11.23】OPENWRT下的adguardhome与Openclash的使用

本期教程参考：[OpenClash使用教程，添加节点|过滤广告|dns防劫持|秒解析| 添加订阅|流量分流|策略组讲解，OpenWrt软路由翻墙，AdGuardHome+openclash详细配置教程，解决DNS污染 - YouTube](https://www.youtube.com/watch?v=2YYa-IM1H8E)

### OpenClash

主路由模式下，先开启Openclash，设置里进行修改

#### 模式设置

主要是切换到FakeIP

![image-20221123203540451](https://i0.hdslb.com/bfs/album/90bc4a81aa813fa4e961aab0283b12a84947006a.png)

#### 基本设置

urltest可以改一下，记住当页的7874

![image-20221123203816443](https://i0.hdslb.com/bfs/album/6ccba82120b001cb389d5d25367f0b4a28f9a9fd.png)

#### DNS设置

当要使用adguard home的时候要取消本地DNS劫持

然后开启自定义上游DNS

![image-20221123203925575](https://i0.hdslb.com/bfs/album/aba75bac599f27c9a813230b5c425e2a69735882.png)

下方的全部勾选

![image-20221123205809855](https://i0.hdslb.com/bfs/album/76a75887b2da52466a415a8100d262e1b98942b3.png)

#### META设置、流媒体增强

VMESS才会用，跳过，如果要开流媒体增强的话，meta见下图

![image-20221123204304290](https://i0.hdslb.com/bfs/album/56d7d8a4b6c925e29c2bcfe8b961ddaaa1e80379.png)

#### 访问控制、规则设置

跳过

#### 外部控制

### AdguardHome

选择DNSMASQ的上游服务器

![image-20221123210416573](https://i0.hdslb.com/bfs/album/a4ff40c408656f75bbde6dd7df843248eb456cb3.png)

在设置里面

![image-20221123210445188](https://i0.hdslb.com/bfs/album/047b904822207b451e7b955a8966ad7938d1e34f.png)

虽然报错，但是能用

规则里面加入

```
https://cats-team.github.io/AdRules/dns.txt
```

